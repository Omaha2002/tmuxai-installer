# -----------------------------------------------------------------------------
# TMUXAI ENHANCED CONFIGURATION WITH BROWSER AUTOMATION
# Version: 2.4.0 - Playwright MCP Integration
# -----------------------------------------------------------------------------

whitelist_patterns:
# Navigation & File Listing (Enhanced)
  - "^ls($| .*)"             # List files
  - "^ll($| .*)"             # Long listing
  - "^la($| .*)"             # List all files
  - "^pwd$"                  # Print working directory
  - "^cd($| .*)"             # Change directory (safe navigation)
  - "^pushd($| .*)"          # Push directory
  - "^popd$"                 # Pop directory
  - "^dirs$"                 # Show directory stack
  - "^tree($| .*)"           # Tree view of directories
  - "^file($| .*)"           # File type identification
  
  # File Reading & Inspection (Enhanced)
  - "^cat($| .*)"            # Read file content
  - "^less($| .*)"           # Paginated file reading
  - "^more($| .*)"           # Paginated file reading
  - "^head($| .*)"           # First lines of file
  - "^tail($| .*)"           # Last lines of file
  - "^wc($| .*)"             # Word/line/char count
  - "^stat($| .*)"           # File statistics
  - "^find .* -type f.*"     # Find files (read-only check)
  - "^locate($| .*)"         # Locate files
  - "^which($| .*)"          # Find command location
  - "^whereis($| .*)"        # Locate binary/source/manual
  
  # System Status & Info (Enhanced)
  - "^date$"                 # Check date
  - "^whoami$"               # Check user
  - "^id$"                   # User and group IDs
  - "^uptime$"               # Check system uptime
  - "^free($| .*)"           # Check memory
  - "^df($| .*)"             # Check disk space
  - "^du($| .*)"             # Check disk usage
  - "^lscpu$"                # CPU information
  - "^lsblk$"                # Block devices
  - "^mount$"                # Mounted filesystems
  - "^ps($| .*)"             # Process status
  - "^top($| .*)$$"          # Process monitor
  - "^htop($| .*)"           # Enhanced process monitor
  - "^jobs$"                 # Active jobs
  - "^history($| .*)"        # Command history
  - "^env$"                  # Environment variables
  - "^printenv($| .*)"       # Print environment
  
  # Git Operations (Enhanced - Read-only + Safe Operations)
  - "^git status.*"          # Repository status
  - "^git log.*"             # Commit history
  - "^git diff.*"            # Show differences
  - "^git show.*"            # Show commit details
  - "^git branch($| .*)"     # List/show branches
  - "^git remote($| .*)"     # Remote repository info
  - "^git config --list$"    # List git config
  - "^git config --get.*"    # Get specific config
  - "^git ls-files.*"        # List tracked files
  - "^git blame.*"           # Show file annotations
  - "^git reflog.*"          # Reference log
  - "^git tag($| .*)"        # List tags
  - "^git stash list$"       # List stashes
  - "^git stash show.*"      # Show stash content
  
  # Development Tools (Safe operations)
  - "^npm list.*"            # List npm packages
  - "^pip list.*"            # List pip packages
  - "^pip show.*"            # Show package info
  - "^composer show.*"       # Show composer packages
  - "^cargo tree.*"          # Show cargo dependencies
  - "^go list.*"             # List go packages
  - "^mvn dependency:tree$"  # Maven dependencies
  
  # Networking (Info only - Enhanced)
  - "^ping -c [0-9]+ .*"     # Limited ping
  - "^curl -I .*"            # Headers only
  - "^curl -s .*"            # Silent mode (for API checks)
  - "^wget --spider .*"      # Check if URL exists
  - "^ip addr.*"             # IP addresses
  - "^ifconfig.*"            # Network interfaces
  - "^netstat($| .*)"        # Network statistics
  - "^ss($| .*)"             # Socket statistics
  - "^nslookup.*"            # DNS lookup
  - "^dig($| .*)"            # DNS lookup tool
  
  # Text Processing & Search (Enhanced)
  - "^grep($| .*)"           # Text search
  - "^egrep($| .*)"          # Extended grep
  - "^fgrep($| .*)"          # Fixed string grep
  - "^rg($| .*)"             # Ripgrep
  - "^ag($| .*)"             # Silver searcher
  - "^awk($| .*)"            # Text processing
  - "^sed -n($| .*)"         # Safe sed print (read-only line extraction)
  - "^sed 's/.*/.*/'.*"      # Safe sed substitution (view only)
  - "^sort($| .*)"           # Sort lines
  - "^uniq($| .*)"           # Unique lines
  - "^cut($| .*)"            # Cut fields
  - "^tr($| .*)"             # Translate characters
  - "^echo($| .*)"           # Echo text
  - "^printf($| .*)"         # Formatted output
  
  # Archive Operations (Read-only)
  - "^tar -tf .*"            # List tar contents
  - "^unzip -l .*"           # List zip contents
  - "^7z l .*"               # List 7z contents
  - "^zcat($| .*)"           # Read compressed files
  - "^gunzip -l .*"          # List gzip info
  
  # Browser Automation (MCP Server - Safe Operations Only)
  - "^playwright_navigate .*"   # Navigate to websites
  - "^playwright_snapshot .*"   # Take page snapshots
  - "^playwright_screenshot .*" # Take screenshots
  - "^playwright_extract .*"    # Extract page content
  - "^playwright_search .*"     # Search within pages
  - "^playwright_scroll .*"     # Scroll page content
  - "^playwright_wait .*"       # Wait for elements
  - "^playwright_evaluate .*"   # Evaluate JavaScript (read-only)

blacklist_patterns:
  # Destructive File Operations (Enhanced)
  - "^rm($| .*)"             # Remove files
  - "^rmdir($| .*)"          # Remove directories  
  - "^dd($| .*)"             # Disk dump (can wipe drives)
  - "^mkfs.*"                # Format filesystem
  - "^shred($| .*)"          # Secure delete
  - "^truncate($| .*)"       # Truncate files
  - "^unlink($| .*)"         # Remove files
  - ".*\\| *rm($| .*)"       # Piped rm commands
  
  # File Modifications
  - "^mv($| .*)"             # Move/rename files
  - "^cp .* >.*"             # Copy with redirection
  - ".*> */dev/.*"           # Writing to devices
  - ".* >> */etc/.*"         # Appending to system files
  
  # Permissions & Ownership (Enhanced)
  - "^chmod($| .*)"          # Change permissions
  - "^chown($| .*)"          # Change ownership
  - "^chgrp($| .*)"          # Change group
  - "^umask($| .*)"          # Change umask
  - "^setfacl($| .*)"        # Set ACL
  - "^chattr($| .*)"         # Change attributes
  
  # System State & Process Control (Enhanced)
  - "^shutdown.*"            # System shutdown
  - "^reboot.*"              # System reboot
  - "^halt.*"                # System halt
  - "^poweroff.*"            # Power off
  - "^init [0-6]"            # Change runlevel
  - "^systemctl.*"           # System service control
  - "^service.*"             # Service control
  - "^kill($| .*)"           # Kill processes
  - "^killall($| .*)"        # Kill all processes
  - "^pkill($| .*)"          # Pattern-based kill
  - "^nohup.*&$"             # Background processes
  
  # Network & Security
  - "^iptables($| .*)"       # Firewall rules
  - "^ufw($| .*)"            # Uncomplicated firewall
  - "^ssh.*"                 # SSH connections
  - "^scp($| .*)"            # Secure copy
  - "^rsync($| .*)"          # Remote sync
  - "^nc($| .*)"             # Netcat
  - "^nmap($| .*)"           # Network mapper
  
  # Package Management
  - "^apt($| .*)"            # APT package manager
  - "^yum($| .*)"            # YUM package manager  
  - "^dnf($| .*)"            # DNF package manager
  - "^pacman($| .*)"         # Pacman package manager
  - "^brew install.*"        # Homebrew install
  - "^pip install.*"         # Pip install
  - "^npm install.*"         # NPM install
  - "^gem install.*"         # Ruby gem install
  
  # Browser Automation - Dangerous Operations
  - "^playwright_click .*"     # Block direct clicking (potential for harmful actions)
  - "^playwright_fill .*"      # Block form filling (prevent data submission)
  - "^playwright_submit .*"    # Block form submission
  - "^playwright_download .*"  # Block file downloads
  - "^playwright_upload .*"    # Block file uploads
  - "^playwright_delete .*"    # Block deletion operations
  - ".*login.*"               # Block login attempts
  - ".*password.*"            # Block password-related operations
  
  # Dangerous Patterns & Malicious Commands
  - ".*> */dev/sd.*"         # Writing to raw devices
  - ":(){ :|:& };:"          # Fork bomb
  - ".*/dev/zero.*"          # Zero device operations
  - ".*\\| *sh$"             # Piped shell execution
  - ".*\\| *bash$"           # Piped bash execution
  - "^\\*.*"                 # Glob expansions that could be dangerous
  - ".*;.*"                  # Command chaining (potentially dangerous)

# -----------------------------------------------------------------------------
# MCP SERVER CONFIGURATION
# -----------------------------------------------------------------------------
mcp_servers:
  playwright:
    enabled: true
    command: "npx"
    args: [
      "@playwright/mcp@latest",
      "--headless",
      "--allowed-origins", "github.com;stackoverflow.com;docs.docker.com;kubernetes.io;nodejs.org;python.org",
      "--timeout-navigation", "30000",
      "--timeout-action", "10000"
    ]
    working_directory: "~/.config/tmuxai/mcp/playwright"
    auto_start: true
    restart_on_failure: true

# -----------------------------------------------------------------------------
# MODEL CONFIGURATION  
# -----------------------------------------------------------------------------
models:
  primary:
    provider: openrouter
    base_url: "https://api.mistral.ai/v1"
    api_key: "{{API_KEY_PLACEHOLDER}}"
    model: "devstral-latest"
    # Enhanced model parameters for better performance
    temperature: 0.1          # Lower temperature for more focused responses
    max_tokens: 2048          # Adequate token limit
    top_p: 0.9               # Nucleus sampling

# -----------------------------------------------------------------------------
# ENHANCED GLOBAL SETTINGS
# -----------------------------------------------------------------------------
debug: false
exec_confirm: true           # Always confirm before execution
max_history: 50             # Keep more context
context_window: 8000        # Larger context window
auto_save_session: true     # Save session history

# -----------------------------------------------------------------------------
# ENHANCED PROMPT SETTINGS
# -----------------------------------------------------------------------------

prompts:
    # Enhanced system prompt with browser automation capabilities
    base_system: >
      You are Devstral, a concise terminal assistant with browser automation capabilities.
      
      RESPONSE RULES:
      1. For simple/common commands (ls, cd, pwd, cat, grep, git status, etc.): NO explanations whatsoever
      2. For research requests (research, browse, find online, check documentation): Use browser automation to gather information from trusted sources
      3. For complex/dangerous commands: Provide brief safety notes only
      4. For troubleshooting requests: Provide focused analysis, use browser research when needed
      
      SIMPLE COMMANDS (no explanation needed):
      - Navigation: ls, ll, cd, pwd, tree
      - File viewing: cat, less, head, tail, file
      - Basic info: date, whoami, history, ps
      - Git basics: status, log, diff, branch
      - Development: npm list, pip show, cargo tree
      
      BROWSER AUTOMATION:
      - Use for: GitHub repositories, Stack Overflow solutions, official documentation, troubleshooting guides
      - Focus on: Safe read-only operations (navigate, snapshot, extract content)
      - Never: Login attempts, form submission, file downloads
      
      OUTPUT FORMATS:
      - Commands only: Just the command, no commentary
      - When explanation needed: Brief technical notes with # comments
      
      Be direct and minimal. Users don't need explanations for basic commands.
    
    # Enhanced chat mode with browser automation capabilities
    chat_assistant: >
      You are Devstral, a direct terminal expert with browser automation capabilities.
      
      RESPONSE GUIDELINES:
      - Be concise and direct
      - Skip explanations for simple commands (ls, cd, cat, git status, etc.)
      - For research requests: Use browser automation to gather information from GitHub, Stack Overflow, documentation sites
      - For complex topics: Use simple bullet points, avoid excessive formatting
      - Focus on practical solutions over theory
      - Use # for comments when providing command explanations
      
      BROWSER RESEARCH:
      - Automatically research solutions when encountering complex problems
      - Focus on trusted sources: GitHub, official docs, Stack Overflow
      - Extract relevant information and present concisely
      
      COMMUNICATION STYLE:
      - Direct answers without fluff
      - Essential information only
      - Commands with minimal context when needed
      - Skip obvious explanations
      
      Keep responses brief and actionable.
    
    # Context-aware mode with browser-powered debugging
    chat_assistant_prepared: >
      You are Devstral with web research capabilities. Analyze context: 'user@host:cwd[exit_code]'.
      
      BEHAVIOR:
      - If exit_code = 0 and command is simple (ls, cd, etc.): Stay silent or minimal response
      - If exit_code â‰  0: Focus on the error, research solutions online if needed, provide fix
      - For successful complex operations: Brief acknowledgment only
      
      ERROR RESPONSES:
      # Brief error description
      # Research similar issues online if complex
      # Fix command(s)
      # Expected result
      
      BROWSER RESEARCH FOR ERRORS:
      - Use browser automation to look up error messages on Stack Overflow
      - Search GitHub for similar issues and solutions
      - Check official documentation for troubleshooting guides
      
      SUCCESS RESPONSES (when needed):
      # Brief confirmation
      
      Skip commentary on routine successful operations.

# -----------------------------------------------------------------------------
# ADDITIONAL ENHANCEMENTS
# -----------------------------------------------------------------------------

# Session management
session:
  auto_save: true
  history_limit: 1000
  save_location: "~/.tmuxai/sessions"

# Performance tuning
performance:
  response_timeout: 30
  retry_attempts: 3
  cache_responses: true
  cache_duration: 300  # 5 minutes

# UI/UX improvements
interface:
  show_thinking: false      # Don't show AI thinking process
  colored_output: true      # Enable colored responses
  timestamps: false         # Don't show timestamps by default
  command_preview: true     # Show command before execution