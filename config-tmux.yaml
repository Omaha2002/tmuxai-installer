# -----------------------------------------------------------------------------
# SAFETY CONFIGURATION
# Use 'whitelist_patterns' to match the internal key seen in /config
# -----------------------------------------------------------------------------

whitelist_patterns:
# Navigation & File Listing
  - "^ls($| .*)"             # List files
  - "^ll($| .*)"
  - "^pwd$"                  # Print working directory
  - "^cd($| .*)"             # Change directory (safe navigation)
  - "^cat($| .*)"            # Read file content
  - "^find .* -type f.*"     # Find files (read-only check)

  # System Status & Info
  - "^date$"                 # Check date
  - "^whoami$"               # Check user
  - "^uptime$"               # Check system uptime
  - "^free($| .*)"           # Check memory
  - "^df($| .*)"             # Check disk space
  - "^du($| .*)"             # Check disk usage
  - "^top($| .*)"            # Process monitor (interactive but safe to start)
  - "^htop($| .*)"           # Process monitor

  # Git (Read-only operations)
  - "^git status.*"
  - "^git log.*"
  - "^git diff.*"
  - "^git show.*"
  - "^git branch$"
  - "^git remote -v"

  # Networking (Info only)
  - "^ping -c [0-9]+ .*"     # Ping (safe if count is limited)
  - "^curl -I .*"            # Curl headers only
  - "^ip addr.*"             # Check IP addresses
  - "^ifconfig.*"

  # Text Processing & Analysis (Safe filters)
  - "^grep .*"
  - "^echo .*"
  - "^head($| .*)"            # View file beginning
  - "^tail($| .*)"            # View file end
  - "^wc($| .*)"              # Word/line/character count
  - "^sort($| .*)"            # Sort content
  - "^uniq($| .*)"            # Remove duplicates
  - "^awk .*"                 # Text processing
  - "^sed -n .*"              # Stream editor (read-only with -n flag)

  # Browser Automation (MCP Server - Safe Operations Only)
  - "^playwright_navigate .*"   # Navigate to websites
  - "^playwright_snapshot .*"   # Take page snapshots
  - "^playwright_screenshot .*" # Take screenshots
  - "^playwright_extract .*"    # Extract page content
  - "^playwright_search .*"     # Search within pages
  - "^playwright_scroll .*"     # Scroll page content
  - "^playwright_wait .*"       # Wait for elements
  - "^playwright_evaluate .*"   # Evaluate JavaScript (read-only)

blacklist_patterns:
  # Destructive File Operations
  - "^rm .*"                 # Remove files
  - "^rm -rf .*"             # Force recursive remove (DANGER)
  - "^dd .*"                 # Disk dump (can wipe drives)
  - "^mkfs.*"                # Format filesystem
  - "^shred .*"              # Secure delete

  # Permissions & Ownership
  - "^chmod .*"              # Change mode
  - "^chown .*"              # Change owner

  # System State
  - "^shutdown.*"
  - "^reboot.*"
  - "^init [0-6]"
  - "^kill .*"               # Killing processes
  - "^killall .*"
  # Dangerous Redirection
  - ".*> /dev/sd.*"          # Writing directly to a raw device
  - ":(){ :|:& };:"          # Fork bomb pattern

  # Browser Automation - Dangerous Operations
  - "^playwright_click .*"     # Block direct clicking (potential for harmful actions)
  - "^playwright_fill .*"      # Block form filling (prevent data submission)
  - "^playwright_submit .*"    # Block form submission
  - "^playwright_download .*"  # Block file downloads
  - "^playwright_upload .*"    # Block file uploads
  - "^playwright_delete .*"    # Block deletion operations
  - ".*login.*"               # Block login attempts
  - ".*password.*"            # Block password-related operations

# -----------------------------------------------------------------------------
# MCP SERVER CONFIGURATION
# -----------------------------------------------------------------------------
mcp_servers:
  playwright:
    enabled: true
    command: "npx"
    args: [
      "@playwright/mcp@latest",
      "--headless",
      "--allowed-origins", "github.com;stackoverflow.com;docs.docker.com;kubernetes.io;nodejs.org;python.org",
      "--timeout-navigation", "30000",
      "--timeout-action", "10000"
    ]
    working_directory: "~/.config/tmuxai/mcp/playwright"
    auto_start: true
    restart_on_failure: true

# -----------------------------------------------------------------------------
# MODEL CONFIGURATION
# -----------------------------------------------------------------------------
models:
  primary:
    provider: openrouter
    base_url: "https://api.mistral.ai/v1"
    api_key: "GMkftRfD4xFCQ9mcLOSvesaDXdmCRB55"
    model: "devstral-latest"
# -----------------------------------------------------------------------------
# GLOBAL SETTINGS
# -----------------------------------------------------------------------------
debug: false
exec_confirm: true

# -----------------------------------------------------------------------------
# PROMPT SETTINGS
# -----------------------------------------------------------------------------

prompts:
    # Balanced approach: concise for simple commands, detailed for analysis
    base_system: >
      You are an intelligent terminal assistant with browser automation capabilities.
      1. For simple commands (like 'ls', 'cat file.txt', 'git status', 'head', 'tail', 'grep', 'wc'), output ONLY the shell command with no explanation.
      2. For research requests (containing 'research', 'browse', 'find online', 'check documentation', 'look up'), use browser automation to gather information from trusted sources like GitHub, Stack Overflow, official documentation.
      3. ONLY provide analysis when the user's original request contains analysis words like 'analyze', 'explain', 'how', 'what does', 'why', 'troubleshoot', 'debug'. Do NOT explain individual commands that are part of an analysis sequence.
      4. When providing analysis, give ONE comprehensive summary at the end, not explanations for each command. EVERY line of text must start with a `#` character (so it is valid shell syntax).
      5. Browser automation should focus on: GitHub repositories, Stack Overflow solutions, official documentation, and troubleshooting guides. Never attempt login or form submission.
      6. Do not use markdown formatting like **bold** or `code blocks`.
    chat_assistant: "You are a technical terminal expert with browser automation capabilities. Execute commands without explanation unless the user specifically asks for analysis or explanation. For research requests, use browser automation to gather information from GitHub, documentation sites, and Stack Overflow. When analysis is requested, provide ONE comprehensive summary rather than explaining each individual command."
    chat_assistant_prepared: "You are an intelligent CLI assistant with web research capabilities. The user prompt contains context: 'user@host:cwd[exit_code]'. If exit_code â‰  0, provide debugging help by researching solutions online if needed. Otherwise, execute commands without explanation unless analysis is explicitly requested. Use browser automation for documentation lookup and troubleshooting research."
